<!DOCTYPE html>
<html>

<head>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col s12 m6">
        <div class="card blue-grey darken-1">
          <div class="card-content white-text">
            <span class="card-title" id="title"></span>
            <p id="song"></p>
          </div>
          <div class="card-action">
            <button class="btn waves-effect waves-light" type="button" value="run" id="btn" onClick="requestSong()">Request
            <i class="material-icons right">music_note</i>
            </button>
            <p id="check"></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--JavaScript at end of body for optimized loading-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    window.setInterval(function() {
      google.script.run.withSuccessHandler(getCrrentRowData).getCrrentRowData();
    }, 700);

    var artist = document.getElementById("title")
    var song = document.getElementById("song")
    var artistValue;
    var songValue;


    function requestSong(){
      console.log('Pressed button')
      const data = {
        artist: artistValue,
        song: songValue
      }
      google.script.run.sendEmail(data)
    }

    function getCrrentRowData() {
      google.script.run
        .withSuccessHandler(function (result) {
          artist.innerText = result.artist;
          song.innerText = result.song;
          artistValue = result.artist;
          songValue = result.song;
      }).getCrrentRowData();
    }
  </script>
</body>

</html>